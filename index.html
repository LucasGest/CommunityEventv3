<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Community Event | Site en construction</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="icon" href="img/travaux.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  </head>
  <body>
    <div id="presentation">
      <h1>ğŸ‰ Site du Community Event en travaux ğŸ‰</h1>
      <div id="compte_a_rebours"></div>
    </div>

    <div class="like-container">
      <p>Likez</p>
      <button id="likeBtn" class="like-btn">â¤ï¸</button>
      <span id="likeCount" class="like-count">0</span>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        get,
        set,
        runTransaction,
      } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCU7s7ypbRbhw6tNRo_UpTMYrlutv6U-bA",
        authDomain: "communityevent-3197a.firebaseapp.com",
        databaseURL:
          "https://communityevent-3197a-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "communityevent-3197a",
        storageBucket: "communityevent-3197a.firebasestorage.app",
        messagingSenderId: "116519039463",
        appId: "1:116519039463:web:a037ee9c2c45b4b8020d42",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // RÃ©fÃ©rence vers ton compteur global
      const likeRef = ref(db, "likes/count");

      const likeBtn = document.getElementById("likeBtn");
      const likeCount = document.getElementById("likeCount");

      // Charger le compteur au dÃ©marrage
      async function loadLikes() {
        const snapshot = await get(likeRef);
        if (snapshot.exists()) {
          likeCount.textContent = snapshot.val();
        } else {
          await set(likeRef, 0);
          likeCount.textContent = 0;
        }
      }

      // Ajouter un like
      function addLike() {
        runTransaction(likeRef, (currentValue) => {
          return (currentValue || 0) + 1;
        })
          .then(() => {
            likeBtn.classList.add("liked");
            setTimeout(() => likeBtn.classList.remove("liked"), 300);
          })
          .catch((err) => console.error("Erreur transaction :", err));
      }

      // Ã‰coute les changements en temps rÃ©el (si d'autres like en mÃªme temps)
      import { onValue } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
      onValue(likeRef, (snapshot) => {
        likeCount.textContent = snapshot.val() ?? 0;
      });

      // Initialisation
      loadLikes();
      likeBtn.addEventListener("click", addLike);
    </script>

    <script>
      document.addEventListener("mousemove", (event) => {
        confetti({
          particleCount: 5,
          spread: 30,
          origin: {
            x: event.clientX / window.innerWidth,
            y: event.clientY / window.innerHeight,
          },
        });
      });
    </script>
  </body>
</html>
